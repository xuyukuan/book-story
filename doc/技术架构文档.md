# Book's Story æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [é¡¹ç›®æ•´ä½“æ¶æ„å›¾å’ŒæŠ€æœ¯æ ˆè¯´æ˜](#é¡¹ç›®æ•´ä½“æ¶æ„å›¾å’ŒæŠ€æœ¯æ ˆè¯´æ˜)
3. [æ ¸å¿ƒæ¨¡å—åŠŸèƒ½è§£æå’Œä»£ç ç»“æ„è¯´æ˜](#æ ¸å¿ƒæ¨¡å—åŠŸèƒ½è§£æå’Œä»£ç ç»“æ„è¯´æ˜)
4. [å…³é”®æŠ€æœ¯å®ç°åŸç†å’Œå…³é”®ä»£ç ç‰‡æ®µåˆ†æ](#å…³é”®æŠ€æœ¯å®ç°åŸç†å’Œå…³é”®ä»£ç ç‰‡æ®µåˆ†æ)
5. [æ•°æ®æµå‘å’Œæ¥å£è®¾è®¡è¯´æ˜](#æ•°æ®æµå‘å’Œæ¥å£è®¾è®¡è¯´æ˜)
6. [éƒ¨ç½²æ¶æ„å’Œä¾èµ–å…³ç³»è¯´æ˜](#éƒ¨ç½²æ¶æ„å’Œä¾èµ–å…³ç³»è¯´æ˜)
7. [æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨è€ƒè™‘è¦ç‚¹](#æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨è€ƒè™‘è¦ç‚¹)

---

## ğŸ“– é¡¹ç›®æ¦‚è¿°

**Book's Story** æ˜¯ä¸€æ¬¾åŸºäº Material You è®¾è®¡çš„å¼€æºç”µå­ä¹¦é˜…è¯»å™¨ï¼Œä¸“ä¸º Android å¹³å°å¼€å‘ã€‚è¯¥åº”ç”¨é‡‡ç”¨ç°ä»£åŒ–çš„ Android å¼€å‘æŠ€æœ¯æ ˆï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼ï¼Œæä¾›é«˜åº¦å¯å®šåˆ¶çš„é˜…è¯»ä½“éªŒã€‚

### æ ¸å¿ƒç‰¹æ€§
- æ”¯æŒ 7 ç§æ–‡ä»¶æ ¼å¼ï¼š`.pdf`ã€`.txt`ã€`.epub`ã€`.fb2`ã€`.html`ã€`.htm`ã€`.md`
- Material You è®¾è®¡è¯­è¨€ï¼Œæ”¯æŒåŠ¨æ€ä¸»é¢˜å’Œé¢œè‰²é¢„è®¾
- åŸºäº Storage Access Framework çš„æ–‡ä»¶ç®¡ç†
- é«˜åº¦å¯å®šåˆ¶çš„é˜…è¯»ç•Œé¢
- å®Œå…¨å¼€æºã€æ— å¹¿å‘Š

---

## ğŸ—ï¸ é¡¹ç›®æ•´ä½“æ¶æ„å›¾å’ŒæŠ€æœ¯æ ˆè¯´æ˜

### æ¶æ„æ¨¡å¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   UI Components â”‚  â”‚   ViewModels    â”‚  â”‚  Navigation  â”‚ â”‚
â”‚  â”‚  (Jetpack       â”‚  â”‚   (Hilt)        â”‚  â”‚   System     â”‚ â”‚
â”‚  â”‚   Compose)      â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Domain Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Use Cases     â”‚  â”‚   Repositories  â”‚  â”‚   Entities   â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚   (Interfaces)  â”‚  â”‚              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Repository    â”‚  â”‚   Local Data    â”‚  â”‚  File        â”‚ â”‚
â”‚  â”‚ Implementations â”‚  â”‚   (Room DB)     â”‚  â”‚  Parsers     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒæ¡†æ¶
- **Kotlin**: ä¸»è¦å¼€å‘è¯­è¨€
- **Jetpack Compose**: ç°ä»£åŒ– UI æ¡†æ¶
- **Android Gradle Plugin**: æ„å»ºç³»ç»Ÿ
- **Material 3**: UI è®¾è®¡ç³»ç»Ÿ

#### æ¶æ„ç»„ä»¶
- **Hilt**: ä¾èµ–æ³¨å…¥æ¡†æ¶
- **Room**: æœ¬åœ°æ•°æ®åº“ ORM
- **DataStore**: è½»é‡çº§æ•°æ®å­˜å‚¨
- **Navigation Compose**: å¯¼èˆªç®¡ç†
- **Lifecycle**: ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### æ–‡ä»¶è§£æ
- **PDFBox**: PDF æ–‡ä»¶è§£æ
- **JSoup**: HTML/XML è§£æ
- **CommonMark**: Markdown è§£æ

#### å…¶ä»–æ ¸å¿ƒåº“
- **Coil**: å›¾ç‰‡åŠ è½½
- **Gson**: JSON åºåˆ—åŒ–
- **AboutLibraries**: å¼€æºè®¸å¯è¯ç®¡ç†

---

## ğŸ”§ æ ¸å¿ƒæ¨¡å—åŠŸèƒ½è§£æå’Œä»£ç ç»“æ„è¯´æ˜

### é¡¹ç›®ç»“æ„
```
app/src/main/java/ua/acclorite/book_story/
â”œâ”€â”€ Application.kt                    # åº”ç”¨å…¥å£ç‚¹
â”œâ”€â”€ core/                            # æ ¸å¿ƒå·¥å…·ç±»
â”œâ”€â”€ data/                            # æ•°æ®å±‚
â”‚   â”œâ”€â”€ di/                          # ä¾èµ–æ³¨å…¥é…ç½®
â”‚   â”œâ”€â”€ local/                       # æœ¬åœ°æ•°æ®å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ dto/                     # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â””â”€â”€ room/                    # Room æ•°æ®åº“
â”‚   â”œâ”€â”€ mapper/                      # æ•°æ®æ˜ å°„å™¨
â”‚   â”œâ”€â”€ parser/                      # æ–‡ä»¶è§£æå™¨
â”‚   â””â”€â”€ repository/                  # Repository å®ç°
â”œâ”€â”€ domain/                          # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ repository/                  # Repository æ¥å£
â”‚   â”œâ”€â”€ use_case/                    # ç”¨ä¾‹
â”‚   â””â”€â”€ util/                        # å·¥å…·ç±»
â”œâ”€â”€ presentation/                    # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ about/                       # å…³äºé¡µé¢
â”‚   â”œâ”€â”€ book_info/                   # ä¹¦ç±ä¿¡æ¯é¡µé¢
â”‚   â”œâ”€â”€ browse/                      # æµè§ˆé¡µé¢
â”‚   â”œâ”€â”€ core/                        # æ ¸å¿ƒ UI ç»„ä»¶
â”‚   â”œâ”€â”€ help/                        # å¸®åŠ©é¡µé¢
â”‚   â”œâ”€â”€ history/                     # å†å²è®°å½•é¡µé¢
â”‚   â”œâ”€â”€ library/                     # å›¾ä¹¦é¦†é¡µé¢
â”‚   â”œâ”€â”€ navigator/                   # å¯¼èˆªç»„ä»¶
â”‚   â”œâ”€â”€ reader/                      # é˜…è¯»å™¨é¡µé¢
â”‚   â””â”€â”€ settings/                    # è®¾ç½®é¡µé¢
â””â”€â”€ ui/                              # UI ä¸»é¢˜å’Œæ ·å¼
```

### æ ¸å¿ƒæ¨¡å—è¯¦è§£

#### 1. æ•°æ®å±‚ (Data Layer)
è´Ÿè´£æ•°æ®çš„è·å–ã€å­˜å‚¨å’Œç®¡ç†ï¼ŒåŒ…æ‹¬ï¼š

**Room æ•°æ®åº“é…ç½®**
```kotlin
@Database(
    entities = [
        BookEntity::class,
        HistoryEntity::class,
        ColorPresetEntity::class,
    ],
    version = 9,
    autoMigrations = [
        AutoMigration(1, 2),
        AutoMigration(2, 3),
        // ... æ›´å¤šè¿ç§»é…ç½®
    ],
    exportSchema = true
)
abstract class BookDatabase : RoomDatabase() {
    abstract val dao: BookDao
}
```

**Repository æ¨¡å¼å®ç°**
```kotlin
@Singleton
class BookRepositoryImpl @Inject constructor(
    private val application: Application,
    private val database: BookDao,
    private val bookMapper: BookMapper,
    private val fileParser: FileParser,
    private val textParser: TextParser
) : BookRepository {
    // å…·ä½“å®ç°...
}
```

#### 2. é¢†åŸŸå±‚ (Domain Layer)
åŒ…å«ä¸šåŠ¡é€»è¾‘å’Œç”¨ä¾‹ï¼š

**ç”¨ä¾‹ç¤ºä¾‹**
```kotlin
class InsertBook @Inject constructor(
    private val repository: BookRepository
) {
    suspend operator fun invoke(book: Book): Boolean {
        return repository.insertBook(book)
    }
}
```

#### 3. è¡¨ç°å±‚ (Presentation Layer)
åŸºäº Jetpack Compose çš„ UI å±‚ï¼š

**ViewModel ç¤ºä¾‹**
```kotlin
@HiltViewModel
class MainModel @Inject constructor(
    private val dataStoreRepository: DataStoreRepository,
    // ... å…¶ä»–ä¾èµ–
) : ViewModel() {
    // UI çŠ¶æ€ç®¡ç†
}
```

---

## âš™ï¸ å…³é”®æŠ€æœ¯å®ç°åŸç†å’Œå…³é”®ä»£ç ç‰‡æ®µåˆ†æ

### 1. ä¾èµ–æ³¨å…¥æ¶æ„ (Hilt)

**åº”ç”¨å…¥å£é…ç½®**
```kotlin
@HiltAndroidApp
class Application : Application() {
    // Hilt è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç 
}
```

**æ¨¡å—é…ç½®**
```kotlin
@Module
@InstallIn(SingletonComponent::class)
abstract class RepositoryModule {
    
    @Binds
    @Singleton
    abstract fun bindBookRepository(
        bookRepositoryImpl: BookRepositoryImpl
    ): BookRepository
    
    // ... å…¶ä»–ç»‘å®š
}
```

### 2. æ–‡ä»¶è§£æç³»ç»Ÿ

**å¤šæ ¼å¼æ–‡ä»¶è§£æå™¨**
```kotlin
class FileParserImpl @Inject constructor(
    private val txtFileParser: TxtFileParser,
    private val pdfFileParser: PdfFileParser,
    private val epubFileParser: EpubFileParser,
    private val fb2FileParser: Fb2FileParser,
    private val htmlFileParser: HtmlFileParser,
) : FileParser {

    override suspend fun parse(cachedFile: CachedFile): BookWithCover? {
        val fileFormat = ".${cachedFile.name.substringAfterLast(".")}".lowercase().trim()
        return when (fileFormat) {
            ".pdf" -> pdfFileParser.parse(cachedFile)
            ".epub" -> epubFileParser.parse(cachedFile)
            ".txt" -> txtFileParser.parse(cachedFile)
            ".fb2" -> fb2FileParser.parse(cachedFile)
            ".html", ".htm" -> htmlFileParser.parse(cachedFile)
            ".md" -> txtFileParser.parse(cachedFile)
            else -> null
        }
    }
}
```

**PDF è§£æå®ç°**
```kotlin
class PdfTextParser @Inject constructor(
    private val markdownParser: MarkdownParser,
    private val application: Application
) : TextParser {

    override suspend fun parse(cachedFile: CachedFile): List<ReaderText> {
        PDFBoxResourceLoader.init(application)
        
        val pdfStripper = PDFTextStripper()
        pdfStripper.paragraphStart = "</br>"

        PDDocument.load(cachedFile.openInputStream()).use {
            val oldText = pdfStripper.getText(it).replace("\r", "")
            // æ–‡æœ¬å¤„ç†å’Œæ ¼å¼åŒ–...
        }
    }
}
```

### 3. Jetpack Compose å¯¼èˆªç³»ç»Ÿ

**è‡ªå®šä¹‰å¯¼èˆªå™¨**
```kotlin
@Composable
fun Navigator(
    modifier: Modifier = Modifier,
    initialScreen: Screen,
    transitionSpec: AnimatedContentTransitionScope<Screen>.(lastEvent: StackEvent) -> ContentTransform,
    content: @Composable (currentScreen: Screen) -> Unit
) {
    val navigator = rememberNavigator(initialScreen = initialScreen)
    
    CompositionLocalProvider(LocalNavigator provides navigator) {
        AnimatedContent(
            modifier = modifier.fillMaxSize().background(MaterialTheme.colorScheme.surface),
            targetState = currentScreen.value,
            transitionSpec = { transitionSpec(this, lastEvent.value) },
            content = { content(it) }
        )
    }
}
```

### 4. Material You ä¸»é¢˜ç³»ç»Ÿ

**åŠ¨æ€ä¸»é¢˜é…ç½®**
```kotlin
@Composable
fun BookStoryTheme(
    theme: Theme,
    isDark: Boolean,
    isPureDark: Boolean,
    themeContrast: ThemeContrast,
    content: @Composable () -> Unit
) {
    val colorScheme = colorScheme(
        theme = theme,
        darkTheme = isDark,
        isPureDark = isPureDark,
        themeContrast = themeContrast
    )
    val animatedColorScheme = animateColorScheme(targetColorScheme = colorScheme)

    MaterialTheme(
        colorScheme = animatedColorScheme,
        shapes = Shapes(),
        typography = Typography(),
        content = content
    )
}
```

---

## ğŸ”„ æ•°æ®æµå‘å’Œæ¥å£è®¾è®¡è¯´æ˜

### æ•°æ®æµå‘å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    UI       â”‚â”€â”€â”€â–¶â”‚  ViewModel  â”‚â”€â”€â”€â–¶â”‚  Use Case   â”‚
â”‚ (Compose)   â”‚â—€â”€â”€â”€â”‚   (Hilt)    â”‚â—€â”€â”€â”€â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Local     â”‚â—€â”€â”€â”€â”‚ Repository  â”‚â—€â”€â”€â”€â”‚   Domain    â”‚
â”‚ Database    â”‚â”€â”€â”€â–¶â”‚    Impl     â”‚â”€â”€â”€â–¶â”‚ Repository  â”‚
â”‚  (Room)     â”‚    â”‚             â”‚    â”‚ Interface   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ File Parser â”‚
                   â”‚   System    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¥å£è®¾è®¡

#### 1. Repository æ¥å£
```kotlin
interface BookRepository {
    suspend fun insertBook(book: Book): Boolean
    suspend fun updateBooks(books: List<Book>): Boolean
    suspend fun deleteBooks(books: List<Book>): Boolean
    suspend fun searchBooks(query: String): List<Book>
    suspend fun findBookById(id: Int): Book?
}
```

#### 2. æ–‡ä»¶è§£ææ¥å£
```kotlin
interface FileParser {
    suspend fun parse(cachedFile: CachedFile): BookWithCover?
}

interface TextParser {
    suspend fun parse(cachedFile: CachedFile): List<ReaderText>
}
```

#### 3. æ•°æ®è®¿é—®æ¥å£ (DAO)
```kotlin
@Dao
interface BookDao {
    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun insertBook(book: BookEntity)
    
    @Query("SELECT * FROM bookentity WHERE LOWER(title) LIKE '%' || LOWER(:query) || '%'")
    suspend fun searchBooks(query: String): List<BookEntity>
    
    @Query("SELECT * FROM bookentity WHERE id=:id")
    suspend fun findBookById(id: Int): BookEntity
    
    @Delete
    suspend fun deleteBooks(books: List<BookEntity>)
    
    @Update
    suspend fun updateBooks(books: List<BookEntity>)
}
```

### æ•°æ®æ¨¡å‹

#### 1. æ ¸å¿ƒå®ä½“
```kotlin
@Entity(tableName = "bookentity")
data class BookEntity(
    @PrimaryKey(autoGenerate = true)
    val id: Int = 0,
    val title: String,
    val author: String,
    val description: String?,
    val scrollIndex: Int,
    val scrollOffset: Int,
    val progress: Float,
    val filePath: String,
    val lastOpened: Long?,
    val category: Category,
    val coverImage: ByteArray?
)
```

#### 2. å†å²è®°å½•å®ä½“
```kotlin
@Entity(tableName = "historyentity")
data class HistoryEntity(
    @PrimaryKey(autoGenerate = true)
    val id: Int = 0,
    val bookId: Int,
    val time: Long
)
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„å’Œä¾èµ–å…³ç³»è¯´æ˜

### æ„å»ºé…ç½®

#### 1. é¡¹ç›®çº§ build.gradle.kts
```kotlin
plugins {
    alias(libs.plugins.android.application) apply false
    alias(libs.plugins.kotlin.android) apply false
    alias(libs.plugins.kotlin.compose) apply false
    alias(libs.plugins.hilt) apply false
    alias(libs.plugins.ksp) apply false
    alias(libs.plugins.room) apply false
    alias(libs.plugins.aboutlibraries) apply false
}
```

#### 2. åº”ç”¨çº§ build.gradle.kts
```kotlin
plugins {
    alias(libs.plugins.android.application)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.kotlin.compose)
    alias(libs.plugins.hilt)
    alias(libs.plugins.ksp)
    alias(libs.plugins.room)
    alias(libs.plugins.aboutlibraries)
}

android {
    namespace = "ua.acclorite.book_story"
    compileSdk = 35

    defaultConfig {
        applicationId = "ua.acclorite.book_story"
        minSdk = 26
        targetSdk = 35
        versionCode = 10
        versionName = "1.5.0"
    }
}
```

### æ ¸å¿ƒä¾èµ–å…³ç³»

#### 1. UI æ¡†æ¶ä¾èµ–
```kotlin
dependencies {
    // Compose BOM
    implementation(platform(libs.compose.bom))
    implementation(libs.compose.ui)
    implementation(libs.compose.ui.tooling.preview)
    implementation(libs.compose.material3)
    implementation(libs.compose.material.icons.extended)
    
    // Activity Compose
    implementation(libs.activity.compose)
}
```

#### 2. æ¶æ„ç»„ä»¶ä¾èµ–
```kotlin
dependencies {
    // Hilt
    implementation(libs.hilt.android)
    implementation(libs.hilt.navigation.compose)
    ksp(libs.hilt.compiler)
    
    // Room
    implementation(libs.room.runtime)
    implementation(libs.room.ktx)
    ksp(libs.room.compiler)
    
    // Lifecycle
    implementation(libs.lifecycle.viewmodel.compose)
    implementation(libs.lifecycle.runtime.compose)
}
```

#### 3. æ–‡ä»¶è§£æä¾èµ–
```kotlin
dependencies {
    // PDF è§£æ
    implementation(libs.pdfbox.android)
    
    // HTML/XML è§£æ
    implementation(libs.jsoup)
    
    // Markdown è§£æ
    implementation(libs.commonmark)
}
```

### å‘å¸ƒæ¸ é“
- **GitHub Releases**: ä¸»è¦å‘å¸ƒæ¸ é“
- **F-Droid**: å¼€æºåº”ç”¨å•†åº—
- **IzzyOnDroid**: F-Droid ç¬¬ä¸‰æ–¹ä»“åº“
- **GitLab**: é•œåƒå‘å¸ƒ
- **Codeberg**: é•œåƒå‘å¸ƒ

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨è€ƒè™‘è¦ç‚¹

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. å†…å­˜ç®¡ç†
- **æ–‡ä»¶æµç®¡ç†**: ä½¿ç”¨ `use` æ‰©å±•å‡½æ•°ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾
```kotlin
PDDocument.load(cachedFile.openInputStream()).use { document ->
    // å¤„ç†æ–‡æ¡£
} // è‡ªåŠ¨å…³é—­èµ„æº
```

- **å¤§æ–‡ä»¶å¤„ç†**: å¼‚æ­¥è§£æå’Œåˆ†å—å¤„ç†
```kotlin
suspend fun parseEpub(): List<ReaderText> = withContext(Dispatchers.IO) {
    val jobs = chapterEntries.mapIndexed { index, entry ->
        async(dispatcher) {
            yield() // åç¨‹è®©æ­¥
            parseChapter(entry)
        }
    }
    jobs.awaitAll()
}
```

#### 2. UI æ€§èƒ½ä¼˜åŒ–
- **Compose é‡ç»„ä¼˜åŒ–**: ä½¿ç”¨ `remember` å’Œ `LaunchedEffect`
```kotlin
@Composable
fun BookItem(book: Book) {
    val animatedProgress = animateFloatAsState(
        targetValue = book.progress
    )
    // UI å®ç°...
}
```

- **æ‡’åŠ è½½åˆ—è¡¨**: ä½¿ç”¨ `LazyColumn` å’Œ `LazyListState`
```kotlin
LazyColumn(
    state = listState,
    contentPadding = contentPadding
) {
    items(books) { book ->
        BookItem(book = book)
    }
}
```

#### 3. æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- **æ‰¹é‡æ“ä½œ**: ä½¿ç”¨äº‹åŠ¡å¤„ç†æ‰¹é‡æ•°æ®æ“ä½œ
- **è‡ªåŠ¨è¿ç§»**: ä½¿ç”¨ Room çš„ AutoMigration åŠŸèƒ½

### å®‰å…¨è€ƒè™‘

#### 1. æ–‡ä»¶è®¿é—®å®‰å…¨
- **Storage Access Framework**: ä½¿ç”¨ SAF ç¡®ä¿æ–‡ä»¶è®¿é—®æƒé™
- **è·¯å¾„éªŒè¯**: éªŒè¯æ–‡ä»¶è·¯å¾„çš„åˆæ³•æ€§
```kotlin
private fun CachedFile.canAccess(): Boolean {
    return try {
        openInputStream()?.use { true } ?: false
    } catch (e: Exception) {
        false
    }
}
```

#### 2. æ•°æ®ä¿æŠ¤
- **æœ¬åœ°æ•°æ®åŠ å¯†**: Room æ•°æ®åº“å¯é…ç½®åŠ å¯†
- **æ•æ„Ÿä¿¡æ¯å¤„ç†**: é¿å…åœ¨æ—¥å¿—ä¸­è¾“å‡ºæ•æ„Ÿä¿¡æ¯
```kotlin
Log.i(TAG, "Processing file: ${file.name}") // åªè®°å½•æ–‡ä»¶å
```

#### 3. æƒé™ç®¡ç†
- **æœ€å°æƒé™åŸåˆ™**: åªè¯·æ±‚å¿…è¦çš„æƒé™
- **è¿è¡Œæ—¶æƒé™**: åŠ¨æ€è¯·æ±‚å­˜å‚¨æƒé™
```xml
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
```

#### 4. ä»£ç å®‰å…¨
- **æ··æ·†é…ç½®**: ä½¿ç”¨ ProGuard/R8 è¿›è¡Œä»£ç æ··æ·†
- **ä¾èµ–å®‰å…¨**: å®šæœŸæ›´æ–°ä¾èµ–åº“ç‰ˆæœ¬
- **è¾“å…¥éªŒè¯**: å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯å’Œæ¸…ç†

### ç›‘æ§å’Œè°ƒè¯•

#### 1. æ—¥å¿—ç³»ç»Ÿ
```kotlin
private const val TAG = "BookParser"

Log.i(TAG, "Started parsing: ${file.name}")
Log.w(TAG, "Could not parse file format")
Log.e(TAG, "Parsing failed", exception)
```

#### 2. é”™è¯¯å¤„ç†
```kotlin
try {
    parseFile(file)
} catch (e: Exception) {
    Log.e(TAG, "Parse error", e)
    return null
}
```

#### 3. æ€§èƒ½ç›‘æ§
- ä½¿ç”¨ Android Studio Profiler ç›‘æ§å†…å­˜å’Œ CPU ä½¿ç”¨
- å®ç°è‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- ç›‘æ§åº”ç”¨å¯åŠ¨æ—¶é—´å’Œå“åº”æ—¶é—´

---

## ğŸ“ æ€»ç»“

Book's Story é‡‡ç”¨äº†ç°ä»£åŒ–çš„ Android å¼€å‘æ¶æ„ï¼Œéµå¾ª Clean Architecture åŸåˆ™ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
2. **ç°ä»£æŠ€æœ¯æ ˆ**: ä½¿ç”¨æœ€æ–°çš„ Android å¼€å‘æŠ€æœ¯å’Œæœ€ä½³å®è·µ
3. **é«˜æ€§èƒ½**: ä¼˜åŒ–çš„æ–‡ä»¶è§£æå’Œ UI æ¸²æŸ“æ€§èƒ½
4. **å®‰å…¨å¯é **: å®Œå–„çš„æƒé™ç®¡ç†å’Œé”™è¯¯å¤„ç†æœºåˆ¶
5. **ç”¨æˆ·ä½“éªŒ**: Material You è®¾è®¡ï¼Œé«˜åº¦å¯å®šåˆ¶

è¯¥æ¶æ„è®¾è®¡ç¡®ä¿äº†åº”ç”¨çš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½è¡¨ç°ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¼˜ç§€çš„ç”µå­ä¹¦é˜…è¯»ä½“éªŒã€‚

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2025å¹´1æœˆ*
*é¡¹ç›®ç‰ˆæœ¬: v1.5.0*